{"version":3,"sources":["webpack:///./components/authorize/index.js","webpack:///./components/authorize/authorize.jsx"],"names":["connect","dispatch","actions","bindActionCreators","getOAuthAppInfo","allowOAuth2","React","Component","propTypes","location","PropTypes","object","isRequired","shape","func","constructor","props","super","_defineProperty","this","searchParams","URLSearchParams","search","params","responseType","get","clientId","redirectUri","state","scope","then","data","error","redirect","window","href","setState","message","startsWith","browserHistory","replace","UNSAFE_componentWillMount","test","app","componentDidMount","blocker","document","getElementById","parentNode","removeChild","render","icon","icon_url","icon50","react_default","a","createElement","className","form_error","alt","src","width","height","formatted_markdown_message","id","defaultMessage","values","appName","name","type","onClick","handleDeny","index_es","handleAllow"],"mappings":"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","file":"26.546db236b95a906729e5.js","sourcesContent":["// Copyright (c) 2019-present Vue Technology LLC All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport {connect} from 'react-redux';\nimport {bindActionCreators} from 'redux';\n\nimport {allowOAuth2, getOAuthAppInfo} from 'actions/admin_actions.jsx';\n\nimport Authorize from './authorize';\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        actions: bindActionCreators({\n            getOAuthAppInfo,\n            allowOAuth2,\n        }, dispatch),\n    };\n}\n\nexport default connect(null, mapDispatchToProps)(Authorize);\n","// Copyright (c) 2019-present Vue Technology LLC All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport {FormattedMessage} from 'react-intl';\n\nimport icon50 from 'images/icon50x50.png';\nimport FormError from 'components/form_error.jsx';\nimport {browserHistory} from 'utils/browser_history';\n\nimport FormattedMarkdownMessage from 'components/formatted_markdown_message.jsx';\n\nexport default class Authorize extends React.Component {\n    static get propTypes() {\n        return {\n            location: PropTypes.object.isRequired,\n            actions: PropTypes.shape({\n                getOAuthAppInfo: PropTypes.func.isRequired,\n                allowOAuth2: PropTypes.func.isRequired,\n            }).isRequired,\n        };\n    }\n\n    constructor(props) {\n        super(props);\n\n        this.state = {};\n    }\n\n    UNSAFE_componentWillMount() { // eslint-disable-line camelcase\n        const clientId = (new URLSearchParams(this.props.location.search)).get('client_id');\n        if (!((/^[a-z0-9]+$/).test(clientId))) {\n            return;\n        }\n\n        this.props.actions.getOAuthAppInfo(clientId).then(\n            ({data}) => {\n                if (data) {\n                    this.setState({app: data});\n                }\n            });\n    }\n\n    componentDidMount() {\n        // if we get to this point remove the antiClickjack blocker\n        const blocker = document.getElementById('antiClickjack');\n        if (blocker) {\n            blocker.parentNode.removeChild(blocker);\n        }\n    }\n\n    handleAllow = () => {\n        const searchParams = new URLSearchParams(this.props.location.search);\n        const params = {\n            responseType: searchParams.get('response_type'),\n            clientId: searchParams.get('client_id'),\n            redirectUri: searchParams.get('redirect_uri'),\n            state: searchParams.get('state'),\n            scope: searchParams.get('store'),\n        };\n\n        this.props.actions.allowOAuth2(params).then(\n            ({data, error}) => {\n                if (data && data.redirect) {\n                    window.location.href = data.redirect;\n                } else if (error) {\n                    this.setState({error: error.message});\n                }\n            }\n        );\n    }\n\n    handleDeny = () => {\n        const redirectUri = (new URLSearchParams(this.props.location.search)).get('redirect_uri');\n        if (redirectUri.startsWith('https://') || redirectUri.startsWith('http://')) {\n            window.location.href = redirectUri + '?error=access_denied';\n            return;\n        }\n\n        browserHistory.replace('/error');\n    }\n\n    render() {\n        const app = this.state.app;\n        if (!app) {\n            return null;\n        }\n\n        let icon;\n        if (app.icon_url) {\n            icon = app.icon_url;\n        } else {\n            icon = icon50;\n        }\n\n        let error;\n        if (this.state.error) {\n            error = (\n                <div className='prompt__error form-group'>\n                    <FormError error={this.state.error}/>\n                </div>\n            );\n        }\n\n        return (\n            <div className='container-fluid'>\n                <div className='prompt'>\n                    <div className='prompt__heading'>\n                        <div className='prompt__app-icon'>\n                            <img\n                                alt={'prompt icon'}\n                                src={icon}\n                                width='50'\n                                height='50'\n                            />\n                        </div>\n                        <div className='text'>\n                            <FormattedMarkdownMessage\n                                id='authorize.title'\n                                defaultMessage='**{appName}** would like to connect to your **Vue** user account'\n                                values={{\n                                    appName: app.name,\n                                }}\n                            />\n                        </div>\n                    </div>\n                    <p>\n                        <FormattedMarkdownMessage\n                            id='authorize.app'\n                            defaultMessage='The app **{appName}** would like the ability to access and modify your basic information.'\n                            values={{\n                                appName: app.name,\n                            }}\n                        />\n                    </p>\n                    <h2 className='prompt__allow'>\n                        <FormattedMarkdownMessage\n                            id='authorize.access'\n                            defaultMessage='Allow **{appName}** access?'\n                            values={{\n                                appName: app.name,\n                            }}\n                        />\n                    </h2>\n                    <div className='prompt__buttons'>\n                        <button\n                            type='submit'\n                            className='btn btn-link authorize-btn'\n                            onClick={this.handleDeny}\n                        >\n                            <FormattedMessage\n                                id='authorize.deny'\n                                defaultMessage='Deny'\n                            />\n                        </button>\n                        <button\n                            type='submit'\n                            className='btn btn-primary authorize-btn'\n                            onClick={this.handleAllow}\n                        >\n                            <FormattedMessage\n                                id='authorize.allow'\n                                defaultMessage='Allow'\n                            />\n                        </button>\n                    </div>\n                    {error}\n                </div>\n            </div>\n        );\n    }\n}\n"],"sourceRoot":""}